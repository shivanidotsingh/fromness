<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fromness</title>
    <style>
        body {
            font-family: sans-serif;
            font-size: 12px; /* All fonts set to 12px */
            background-color: #f0f0f0;
            color: #333;
            padding: 10px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        #timeline-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 1px;
            border: none; /* Removed the black outline */
            padding: 1px;
        }
        .month-cell {
            width: 24.75px;
            height: 24.75px;
            border: 1px solid #ccc;
            position: relative;
            cursor: default;
        }
        /* Tooltip styling for hover effect on month cells */
        .month-cell .tooltip-text,
        .country-segment .tooltip-text {
            visibility: hidden;
            background-color: #000;
            color: #fff;
            text-align: center;
            padding: 4-px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid #fff;
        }
        .month-cell:hover .tooltip-text,
        .country-segment:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        /* Make cells larger for mobile for better touch experience */
        @media (max-width: 768px) {
            .month-cell {
                width: 28.4625px; /* 15% larger */
                height: 28.4625px; /* 15% larger */
            }
        }

        /* Scorecard styling */
        #scorecard-container {
            margin-top: 30px;
        }
        #scorecard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .scorecard-title {
            font-size: 12px; /* All fonts set to 12px */
            font-weight: normal;
            text-decoration: underline;
            margin: 0;
        }
        #scorecard-grid {
            display: grid;
            /* Default to 6 columns for desktop */
            grid-template-columns: repeat(6, 1fr);
            font-size: 12px; /* All fonts set to 12px */
            border: 1px solid #ccc;
        }

        /* Media query for mobile to change to a single column */
        @media (max-width: 768px) {
            #scorecard-grid {
                grid-template-columns: repeat(1, 1fr);
            }
        }

        .scorecard-item {
            padding: 5px;
            border: 1px solid #ccc;
            border-top: none;
            border-left: none;
            text-align: left; /* Left-aligned text */
        }
        .scorecard-item:nth-child(6n+1) {
             border-left: 1px solid #ccc;
        }
        
        /* Sorting button styling */
        #sort-button {
            padding: 5px 10px;
            border: 1px solid #ccc;
            background-color: #e0e0e0;
            cursor: pointer;
            border-radius: 5-px;
            font-size: 12px; /* All fonts set to 12px */
        }
        #sort-button:hover {
            background-color: #d0d0d0;
        }

        /* Country Bar Styling */
        #country-bar-container {
            margin-top: 30px;
        }
        #country-bar {
            display: flex;
            width: 100%;
            height: 24.75px; /* Same height as month cells */
            border: none; /* Removed the black outline */
            gap: 1px;
            padding: 1px;
        }
        .country-segment {
            height: 100%;
            position: relative;
            cursor: default;
        }
    </style>
</head>
<body>
    <div class="container">
        <p>Trying to answer the question, 'where are you from?' visually.
            <br>Each square represents one month. Each color represents a city.</p>
        <div id="timeline-grid"></div>
        <div id="scorecard-container">
            <div id="scorecard-header">
                <span class="scorecard-title">Cumulative time</span>
                <button id="sort-button">Sort by Time Lived</button>
            </div>
            <div id="scorecard-grid"></div>
        </div>
        <div id="country-bar-container">
            <div id="country-bar"></div>
        </div>
    </div>

    <script>
        window.onload = function() {
            // Data array to hold city information and colors
            const timelineData = [
                // Combined Qatar and UAE into a single 'Gulf' country category
                { name: "Doha, Qatar", country: "Gulf (Qatar and UAE)", startYear: 1992, startMonth: 5, endYear: 1996, endMonth: 12, color: "#008080" },
                { name: "Abu Dhabi, UAE", country: "Gulf (Qatar and UAE)", startYear: 1997, startMonth: 1, endYear: 2002, endMonth: 3, color: "#00CED1" },
                { name: "Lucknow, India", country: "India", startYear: 2002, startMonth: 4, endYear: 2003, endMonth: 3, color: "#0000FF" },
                { name: "Dehradun, India", country: "India", startYear: 2003, startMonth: 4, endYear: 2010, endMonth: 3, color: "#4B0082" },
                { name: "Ahmedabad, India", country: "India", startYear: 2010, startMonth: 6, endYear: 2014, endMonth: 6, color: "#800080" },
                // Corrected Mumbai data to reflect July 2014 to June 2015 (12 months)
                { name: "Mumbai, India", country: "India", startYear: 2014, startMonth: 7, endYear: 2015, endMonth: 6, color: "#FF00FF" },
                { name: "Bangalore, India", country: "India", startYear: 2015, startMonth: 10, endYear: 2019, endMonth: 7, color: "#FF1493" },
                // Corrected San Francisco to be 3.5 years (42 months), from Aug 2019 to Jan 2023.
                { name: "San Francisco, USA", country: "USA", startYear: 2019, startMonth: 8, endYear: 2023, endMonth: 1, color: "#8B0000" }, 
                { name: "Stockholm, Sweden", country: "Sweden", startYear: 2023, startMonth: 2, endYear: 2025, endMonth: 7, color: "#FF0000" },
                { name: "Goa, India (Internship)", country: "India", color: "#FFA500", isInternship: true, internshipYear: 2012, internshipMonths: [5, 6, 7] },
                { name: "Dubai, UAE (Internship)", country: "Gulf (Qatar and UAE)", color: "#2E8B57", isInternship: true, internshipYear: 2015, internshipMonths: [7, 8, 9] }
            ];

            // The timeline begins in June 1992 and ends in August 2025.
            const startYear = 1992;
            const startMonthIndex = 5; // June is the 6th month, 0-indexed is 5
            const endYear = 2025;
            const endMonthIndex = 7; // August is the 8th month, 0-indexed is 7
            
            // Function to calculate the number of months between two dates, inclusive
            function getMonthCount(startYear, startMonth, endYear, endMonth) {
                return (endYear - startYear) * 12 + (endMonth - startMonth) + 1;
            }
            
            const totalMonths = getMonthCount(startYear, startMonthIndex + 1, endYear, endMonthIndex + 1);

            const gridContainer = document.getElementById('timeline-grid');
            const scorecardGrid = document.getElementById('scorecard-grid');
            const sortButton = document.getElementById('sort-button');
            const countryBar = document.getElementById('country-bar');
            
            let isSortedByTime = false; // Initial state is chronological
            
            // Function to get the first year for sorting chronologically
            function getFirstYear(name) {
                const item = timelineData.find(d => d.name.replace(' (Internship)', '') === name);
                return item ? (item.startYear || item.internshipYear) : Infinity;
            }

            // Get specific city data objects for easy access in the grid rendering loop
            const lucknowData = timelineData.find(d => d.name.includes("Lucknow") && d.startYear === 2002);
            const abuDhabiData = timelineData.find(d => d.name.includes("Abu Dhabi") && !d.isInternship);
            const dohaData = timelineData.find(d => d.name.includes("Doha"));
            const dehradunData = timelineData.find(d => d.name.includes("Dehradun"));
            const stockholmData = timelineData.find(d => d.name.includes("Stockholm"));
            const ahmedabadData = timelineData.find(d => d.name.includes("Ahmedabad"));
            const mumbaiData = timelineData.find(d => d.name.includes("Mumbai"));
            const bangaloreData = timelineData.find(d => d.name.includes("Bangalore"));
            const sanFranciscoData = timelineData.find(d => d.name.includes("San Francisco"));
            const dubaiData = timelineData.find(d => d.name.includes("Dubai"));
            const goaData = timelineData.find(d => d.name.includes("Goa"));
            
            // Map countries to a representative color
            const countryColors = {
                "Gulf (Qatar and UAE)": "linear-gradient(to right, #008080, #00CED1)",
                // Updated India gradient with more colors
                "India": "linear-gradient(to right, #4B0082, #800080, #0000FF, #FF00FF, #FF1493, #FFA500)",
                "USA": "#8B0000",
                "Sweden": "#FF0000"
            };
            
            // Function to determine which city tile should be displayed for a given month index
            function getCityForMonth(monthIndex) {
                // If it's the very first tile, return Lucknow
                if (monthIndex === 0) {
                    return lucknowData;
                }

                // Adjust the monthIndex to get the actual year and month
                const totalMonthCountFromStart = monthIndex + startMonthIndex;
                const currentYear = startYear + Math.floor(totalMonthCountFromStart / 12);
                const currentMonth = totalMonthCountFromStart % 12; // 0-indexed month

                // Check for internship months first, as they have the highest priority
                if (goaData && currentYear === goaData.internshipYear && goaData.internshipMonths.includes(currentMonth + 1)) {
                    return goaData;
                }
                
                // --- Chronological timeline logic ---
                
                // Stockholm (Mar 2023 - Aug 2025)
                if (currentYear >= stockholmData.startYear && (currentYear < endYear || (currentYear === endYear && currentMonth <= endMonthIndex))) {
                    const stockholmStartMonthAbsolute = (stockholmData.startYear * 12) + (stockholmData.startMonth - 1);
                    const currentMonthAbsolute = (currentYear * 12) + currentMonth;
                    const monthsInStockholmPeriod = currentMonthAbsolute - stockholmStartMonthAbsolute;

                    if (monthsInStockholmPeriod > 0 && monthsInStockholmPeriod % 12 === 11) {
                        return lucknowData;
                    }
                    return stockholmData;
                }

                // San Francisco (Aug 2019 - Jan 2023)
                // This logic is now explicitly checking for the correct date range (42 months total)
                if (
                    (currentYear > sanFranciscoData.startYear && currentYear < sanFranciscoData.endYear) ||
                    (currentYear === sanFranciscoData.startYear && currentMonth >= sanFranciscoData.startMonth - 1) ||
                    (currentYear === sanFranciscoData.endYear && currentMonth < sanFranciscoData.endMonth)
                ) {
                    return sanFranciscoData;
                }
                
                // Mumbai (July 2014 - Jun 2015)
                if (
                    (currentYear > mumbaiData.startYear && currentYear < mumbaiData.endYear) ||
                    (currentYear === mumbaiData.startYear && currentMonth >= mumbaiData.startMonth - 1) ||
                    (currentYear === mumbaiData.endYear && currentMonth < mumbaiData.endMonth)
                ) {
                    return mumbaiData;
                }
                
                // Dubai (Internship) - July, August, September 2015 (This must be checked after Mumbai)
                if (currentYear === dubaiData.internshipYear && dubaiData.internshipMonths.includes(currentMonth + 1)) {
                    return dubaiData;
                }
                
                // Bangalore (Oct 2015 - Aug 2019)
                // This period spans 46 months
                if (currentYear >= bangaloreData.startYear && (currentYear < 2019 || (currentYear === 2019 && currentMonth <= 6))) {
                     return bangaloreData;
                }

                // Ahmedabad (June 2010 - June 2014)
                if (currentYear >= 2010 && (currentYear < 2014 || (currentYear === 2014 && currentMonth <= 5))) {
                    const ahmedabadStartMonthAbsolute = (2010 * 12) + 5;
                    const currentMonthAbsolute = (currentYear * 12) + currentMonth;
                    const monthsInAhmedabadPeriod = currentMonthAbsolute - ahmedabadStartMonthAbsolute;
                    
                    if (monthsInAhmedabadPeriod > 0 && monthsInAhmedabadPeriod % 6 === 0) {
                        return lucknowData;
                    }
                    return ahmedabadData;
                }

                // Special case for April and May 2010
                if (currentYear === 2010) {
                    if (currentMonth === 3) { // April 2010
                        return lucknowData;
                    }
                    if (currentMonth === 4) { // May 2010
                        return abuDhabiData;
                    }
                }
                
                // Dehradun (April 2003 - March 2010)
                if (currentYear >= 2003 && (currentYear < 2010 || (currentYear === 2010 && currentMonth <= 2))) {
                    const month = currentMonth + 1; // 1-indexed month
                    if (month === 6 || month === 12) { // June or December
                        return lucknowData;
                    } else if (month === 7 || month === 1) { // July or January
                        return abuDhabiData;
                    } else {
                        // All other months are Dehradun
                        return dehradunData;
                    }
                }
                
                // Lucknow (April 2002 - March 2003)
                if (currentYear >= 2002 && (currentYear < 2003 || (currentYear === 2003 && currentMonth <= 2))) {
                    return lucknowData;
                }

                // Abu Dhabi (Jan 1997 - March 2002)
                if (currentYear >= 1997 && (currentYear < 2002 || (currentYear === 2002 && currentMonth <= 2))) {
                    const abuDhabiStartMonthAbsolute = (1997 * 12) + 0;
                    const currentMonthAbsolute = (currentYear * 12) + currentMonth;
                    const monthsInAbuDhabiPeriod = currentMonthAbsolute - abuDhabiStartMonthAbsolute;
                    
                    if (monthsInAbuDhabiPeriod > 0 && monthsInAbuDhabiPeriod % 12 === 11) {
                         return lucknowData;
                    }
                    return abuDhabiData;
                }
                
                // Doha (June 1992 - Dec 1996)
                if (currentYear >= 1992 && (currentYear < 1997 || (currentYear === 1996 && currentMonth <= 11))) {
                    const dohaStartMonthAbsolute = (1992 * 12) + 5;
                    const currentMonthAbsolute = (currentYear * 12) + currentMonth;
                    const monthsInDohaPeriod = currentMonthAbsolute - dohaStartMonthAbsolute;
                    
                    if (monthsInDohaPeriod > 0 && monthsInDohaPeriod % 12 === 11) {
                        return lucknowData;
                    }
                    return dohaData;
                }

                // Default return if no conditions are met
                return { name: "Unknown", color: "#ccc" };
            }
            
            const finalCityMonths = {};
            const cityColors = {};
            const countryMonths = {};

            // Loop through all months to build the timeline grid and count months for the scorecard and country bar
            for (let i = 0; i < totalMonths; i++) {
                const monthDiv = document.createElement('div');
                const city = getCityForMonth(i);
                
                monthDiv.className = `month-cell`;
                monthDiv.style.backgroundColor = city.color;

                // Add the tooltip for hover functionality
                monthDiv.innerHTML = `<span class="tooltip-text">${city.name}</span>`;

                gridContainer.appendChild(monthDiv);
                
                const displayName = city.name.replace(' (Internship)', '');
                
                // Count months for the scorecard
                if (!finalCityMonths[displayName]) {
                    finalCityMonths[displayName] = 0;
                    cityColors[displayName] = city.color;
                }
                finalCityMonths[displayName]++;

                // Count months for the country bar
                if (city.country) {
                     countryMonths[city.country] = (countryMonths[city.country] || 0) + 1;
                }
            }


            // Function to render the scorecard based on sort type
            function renderScorecard() {
                scorecardGrid.innerHTML = '';
                
                let cityYearTotals = Object.entries(finalCityMonths).map(([name, months]) => ({
                    name: name,
                    months: months,
                    color: cityColors[name]
                }));

                if (!isSortedByTime) { // Chronological
                    cityYearTotals.sort((a, b) => {
                        const yearA = getFirstYear(a.name);
                        const yearB = getFirstYear(b.name);
                        return yearA - yearB;
                    });
                } else { // By time spent
                    cityYearTotals.sort((a, b) => b.months - a.months);
                }

                cityYearTotals.forEach(item => {
                    const scorecardItem = document.createElement('div');
                    scorecardItem.className = 'scorecard-item';
                    
                    let displayTime;
                    const years = item.months / 12;
                    displayTime = `${years.toFixed(2)} years`;
                    
                    const cityName = item.name.split(',')[0];
                    scorecardItem.innerHTML = `<span style="color: ${item.color};">${cityName}</span>: ${displayTime}`;
                    scorecardGrid.appendChild(scorecardItem);
                });
            }
            
            // Function to render the country bar
            function renderCountryBar() {
                countryBar.innerHTML = '';
                const countries = Object.keys(countryMonths);
                
                // Map countries to a representative color
                const countryBarColors = {
                    "Gulf (Qatar and UAE)": "linear-gradient(to right, #008080, #00CED1)",
                    // Updated India gradient with more colors
                    "India": "linear-gradient(to right, #4B0082, #800080, #0000FF, #FF00FF, #FF1493, #FFA500)",
                    "USA": "#8B0000",
                    "Sweden": "#FF0000"
                };


                countries.forEach(country => {
                    const segmentDiv = document.createElement('div');
                    const months = countryMonths[country];
                    const percentage = (months / totalMonths) * 100;

                    segmentDiv.className = 'country-segment';
                    segmentDiv.style.width = `${percentage}%`;
                    
                    // Apply gradient or solid color based on country
                    if (country === "Gulf (Qatar and UAE)") {
                        segmentDiv.style.background = countryBarColors[country];
                    } else if (country === "India") {
                        segmentDiv.style.background = countryBarColors[country];
                    } else {
                        segmentDiv.style.backgroundColor = countryBarColors[country];
                    }

                    // Add a tooltip for the country bar segments
                    let displayTime;
                    const years = months / 12;
                    // Use toFixed(2) for two decimal places
                    displayTime = `${years.toFixed(2)} years`;

                    segmentDiv.innerHTML = `<span class="tooltip-text">${country}: ${displayTime}</span>`;
                    
                    countryBar.appendChild(segmentDiv);
                });
            }

            // Event listener for the sort button
            sortButton.addEventListener('click', () => {
                isSortedByTime = !isSortedByTime; // Toggle the state
                if (isSortedByTime) {
                    sortButton.textContent = "Sort Chronologically";
                } else {
                    sortButton.textContent = "Sort by Time Lived";
                }
                renderScorecard();
            });

            // Initial render of the scorecard (chronological by default)
            renderScorecard();
            renderCountryBar();
        };
    </script>
</body>
</html>
